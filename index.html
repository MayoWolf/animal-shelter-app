<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Shelter Dogs</title>
<meta name="theme-color" content="#0b0b0b">

<style>
:root{

  --bg:#0b0b0b; --bg2:#121212;
  --card:rgba(255,255,255,.06); --card-brd:rgba(255,255,255,.12);
  --text:#f6f7f8; --muted:#b7bfc9;
  --accent:#ff7a00; --accent2:#ff9c33;
  --ok:#4ade80; --warn:#f59e0b; --danger:#ef4444;
  --ring:rgba(255,122,0,.4);
  --shadow:0 20px 40px rgba(0,0,0,.35);
  --radius:18px;
}

@media (prefers-color-scheme: light){
  :root{
    --bg:#ffffff; --bg2:#f6f6f6;
    --card:rgba(255,255,255,.85); --card-brd:rgba(0,0,0,.08);
    --text:#121212; --muted:#606b78;
    --ring:rgba(255,122,0,.25);
    --shadow:0 20px 40px rgba(9,30,66,.12);
  }
}

*{box-sizing:border-box}
body{
  margin:0; color:var(--text);
  font-family: ui-rounded, "SF Pro Rounded", "SF Pro Text",
   -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif;
  background:
    radial-gradient(1100px 800px at 10% -10%, #23170c 0%, transparent 60%),
    radial-gradient(1000px 700px at 110% 40%, #1a130c 0%, transparent 55%),
    linear-gradient(160deg, var(--bg) 0%, var(--bg2) 100%);
  min-height:100svh;
}
.wrap{max-width:1180px;margin:28px auto 64px;padding:0 18px}
header.brand{display:flex;align-items:center;gap:14px;margin-bottom:18px}
.badge{width:44px;height:44px;border-radius:14px;
  background:linear-gradient(145deg, var(--accent), var(--accent2));
  box-shadow: inset 0 1px 0 rgba(255,255,255,.45), 0 14px 28px rgba(255,153,51,.35);
}
h1{margin:0;font-size:clamp(26px,4vw,34px);letter-spacing:.2px}
.subtitle{color:var(--muted);margin-top:6px;font-size:14px}

.grid{display:grid;gap:16px;grid-template-columns:1.2fr .9fr}
@media (max-width: 980px){ .grid{grid-template-columns:1fr} }

.card{
  background:var(--card); border:1px solid var(--card-brd);
  backdrop-filter: blur(16px) saturate(120%);
  border-radius:var(--radius); box-shadow:var(--shadow); overflow:clip;
}

.section{padding:18px;border-bottom:1px solid var(--card-brd)}
.section:last-child{border-bottom:0}

.row{display:flex;flex-wrap:wrap;gap:12px;align-items:center}
.col{flex:1 1 260px; min-width:220px}
.label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
.input, .select, .textarea{
  width:100%; padding:12px 14px; border-radius:12px;
  background:rgba(255,255,255,.06); color:var(--text);
  border:1px solid var(--card-brd); outline:none; font-size:15px;
  transition: box-shadow .2s, border-color .2s, transform .06s;
}
.input:focus, .select:focus, .textarea:focus{
  box-shadow:0 0 0 8px var(--ring); border-color:transparent;
}
.textarea{min-height:96px; resize:vertical}

.radio{
  display:inline-flex; align-items:center; gap:10px; padding:10px 12px;
  border:1px solid var(--card-brd); border-radius:12px;
  background:rgba(255,255,255,.06); cursor:pointer;
}
.radio input{appearance:none;width:16px;height:16px;border-radius:999px;
  border:2px solid var(--muted); position:relative; outline:none;
}
.radio input:checked{border-color:var(--accent)}
.radio input:checked::after{
  content:""; position:absolute; inset:3px; border-radius:999px;
  background:var(--accent);
}

.preview{
  width:100%; aspect-ratio: 16/9; border-radius:14px; overflow:hidden;
  background:rgba(255,255,255,.04); border:1px solid var(--card-brd);
  display:grid; place-items:center; color:var(--muted);
}
.preview img{width:100%;height:100%;object-fit:cover;display:block}

.btn{
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:12px 16px; border-radius:14px; border:1px solid rgba(255,255,255,.12);
  background:linear-gradient(180deg, #1a1a1a, #151515); color:#fff; font-weight:700;
  box-shadow:0 10px 22px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.15);
  cursor:pointer; transition: transform .06s, box-shadow .2s, background .3s;
}
.btn:hover{ transform:translateY(-1px); box-shadow:0 14px 26px rgba(0,0,0,.38) }
.btn:active{ transform:translateY(0) scale(.985) }
.btn[disabled]{opacity:.6;cursor:not-allowed;filter:saturate(.7)}
.btn.primary{
  background:linear-gradient(180deg, var(--accent2), var(--accent));
  color:#101010; border-color:transparent;
  box-shadow:0 10px 22px rgba(255,122,0,.35), inset 0 1px 0 rgba(255,255,255,.35);
}
.btn.ghost{
  background:transparent; border-color:var(--card-brd); color:var(--text);
}

.actions{display:flex;gap:10px;flex-wrap:wrap}
.status{font-size:13px;color:var(--muted)}
.status.ok{color:var(--ok)} .status.err{color:var(--danger)}

.list{max-height: 70vh; overflow:auto; padding:10px}
.item{
  display:flex; gap:12px; align-items:center; padding:10px; border-radius:12px;
  border:1px solid var(--card-brd); cursor:pointer; transition: background .15s, transform .06s;
  background:rgba(255,255,255,.04);
}
.item:hover{ background:rgba(255,255,255,.07); transform:translateY(-1px) }
.thumb{width:58px;height:58px;border-radius:12px;overflow:hidden;border:1px solid var(--card-brd); background:#0c0c0c}
.thumb img{width:100%;height:100%;object-fit:cover}
.meta b{display:block;font-size:15px}
.meta small{color:var(--muted)}
.empty{color:var(--muted);text-align:center;padding:22px 10px}
.kv{color:var(--muted)}

.tools{display:flex;flex-wrap:wrap;gap:8px}
.pill{
  border:1px solid var(--card-brd); border-radius:999px; padding:8px 12px;
  background:rgba(255,255,255,.06); color:var(--text);
}
</style>
</head>
<body>
  <div class="wrap">
    <header class="brand">
      <div class="badge" aria-hidden="true"></div>
      <div>
        <h1>Shelter Dogs</h1>
        <div class="subtitle">Add, search, and filter dogs — one tap to log a walk.</div>
      </div>
    </header>

    <div class="grid">
      <!-- LEFT: Form -->
      <main class="card" id="formCard" aria-labelledby="formTitle">
        <div class="section">
          <h2 id="formTitle" style="margin:0 0 6px;font-size:18px">Dog details</h2>
          <div class="kv" id="metaLine"></div>
          <div class="tools" style="margin-top:10px">
            <span class="pill">Walking Skills: Needs training / Average Walker / Great Walker</span>
            <span class="pill">Upsert by Name</span>
          </div>
        </div>

        <div class="section">
          <div class="row">
            <div class="col">
              <label class="label" for="name">Name</label>
              <input id="name" class="input" placeholder="Luna" autocomplete="off" />
            </div>
            <div class="col">
              <label class="label" for="photoUrl">Photo URL</label>
              <input id="photoUrl" class="input" placeholder="https://…" autocomplete="off" />
            </div>
          </div>

          <div class="row" style="margin-top:10px">
            <div class="col">
              <label class="label">Walking Skills</label>
              <div class="row">
                <label class="radio"><input type="radio" name="walkingSkills" value="Needs training" checked> Needs training</label>
                <label class="radio"><input type="radio" name="walkingSkills" value="Average Walker"> Average Walker</label>
                <label class="radio"><input type="radio" name="walkingSkills" value="Great Walker"> Great Walker</label>
              </div>
            </div>

            <div class="col">
              <label class="label" for="size">Size</label>
              <select id="size" class="select">
                <option value="">Select size…</option>
                <option>Small</option>
                <option>Medium</option>
                <option>Large</option>
                <option>XL</option>
              </select>
            </div>

            <div class="col">
              <label class="label" for="weight">Weight (lb)</label>
              <input id="weight" class="input" type="number" inputmode="decimal" placeholder="48" />
            </div>
          </div>

          <div class="row" style="margin-top:10px">
            <div class="col">
              <label class="label" for="lastWalked">Last time walked</label>
              <div class="row" style="gap:8px">
                <input id="lastWalked" class="input" type="datetime-local" style="flex:1 1 auto; min-width:220px">
                <button id="stampNow" class="btn ghost" type="button" title="Stamp current time">Walked just now</button>
              </div>
            </div>
          </div>

          <div class="row" style="margin-top:10px">
            <div class="col">
              <label class="label" for="notes">Notes</label>
              <textarea id="notes" class="textarea" placeholder="Friendly with kids, avoid other males, loves tennis balls…"></textarea>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="row">
            <div class="col">
              <div class="label">Preview</div>
              <div class="preview" id="preview">
                <span>No photo yet</span>
              </div>
            </div>
          </div>
        </div>

        <div class="section">
          <div class="row" style="align-items:center; justify-content:space-between">
            <div class="actions">
              <button id="saveBtn" class="btn primary" type="button">Save</button>
              <button id="resetBtn" class="btn" type="button">Reset</button>
            </div>
            <div id="status" class="status" role="status" aria-live="polite"></div>
          </div>
        </div>
      </main>

      <!-- RIGHT: Search + Filters + List -->
      <aside class="card">
        <div class="section">
          <h2 style="margin:0 0 12px;font-size:18px">Search & Filter</h2>
          <div class="row">
            <div class="col">
              <label class="label" for="search">Search (name/notes)</label>
              <input id="search" class="input" placeholder="Search dogs…" />
            </div>
            <div class="col">
              <label class="label" for="filterSkill">Walking Skills</label>
              <select id="filterSkill" class="select">
                <option value="">All</option>
                <option>Needs training</option>
                <option>Average Walker</option>
                <option>Great Walker</option>
              </select>
            </div>
            <div class="col">
              <label class="label" for="filterSize">Size</label>
              <select id="filterSize" class="select">
                <option value="">All</option>
                <option>Small</option>
                <option>Medium</option>
                <option>Large</option>
                <option>XL</option>
              </select>
            </div>
          </div>
          <div class="row" style="margin-top:10px">
            <button id="refreshBtn" class="btn" type="button">Refresh from sheet</button>
            <button id="clearFilters" class="btn ghost" type="button">Clear filters</button>
          </div>
        </div>
        <div class="section">
          <div id="dogsList" class="list">
            <div class="empty">No dogs yet — add one on the left.</div>
          </div>
        </div>
      </aside>
    </div>
  </div>

<script>
const $ = (id)=>document.getElementById(id);
const statusEl = $("status");
const previewEl = $("preview");
const listEl = $("dogsList");

let ALL_DOGS = []; // in-memory cache for filtering

function setStatus(msg, kind){
  statusEl.textContent = msg || "";
  statusEl.classList.toggle("ok", kind==="ok");
  statusEl.classList.toggle("err", kind==="err");
}

function isoNowLocal(){
  const d = new Date(); const pad=(n)=>String(n).padStart(2,"0");
  return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}T${pad(d.getHours())}:${pad(d.getMinutes())}`;
}
function localToISO(s){ if(!s) return ""; const dt = new Date(s); return isNaN(dt) ? "" : dt.toISOString(); }

// Live photo preview
$("photoUrl").addEventListener("input", ()=>{
  const url = $("photoUrl").value.trim();
  previewEl.innerHTML = url
    ? `<img src="${url}" alt="Dog photo preview" onerror="this.parentNode.innerHTML='<span>Invalid image URL</span>'">`
    : `<span>No photo yet</span>`;
});
// Stamp now
$("stampNow").addEventListener("click", ()=>{ $("lastWalked").value = isoNowLocal(); });
// Reset form
$("resetBtn").addEventListener("click", ()=>{
  (document.querySelector('input[name="walkingSkills"][value="Needs training"]')||{}).checked = true;
  $("name").value = ""; $("photoUrl").value = ""; $("size").value = ""; $("weight").value = "";
  $("lastWalked").value = ""; $("notes").value = ""; previewEl.innerHTML = `<span>No photo yet</span>`;
  setStatus("");
});

// Save (upsert by Name)
$("saveBtn").addEventListener("click", async ()=>{
  const name = $("name").value.trim();
  if(!name){ setStatus("Please enter a name.", "err"); return; }
  const walkingSkills = (document.querySelector('input[name="walkingSkills"]:checked')||{}).value || "";
  const payload = {
    name,
    photoUrl: $("photoUrl").value.trim(),
    walkingSkills,
    size: $("size").value,
    weight: $("weight").value,
    lastWalked: localToISO($("lastWalked").value),
    notes: $("notes").value.trim()
  };

  try{
    setStatus("Saving…");
    const res = await fetch("/.netlify/functions/dog-submit", {
      method:"POST", headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });
    if(!res.ok){ const txt = await res.text().catch(()=> "Server error"); setStatus("Error: " + txt, "err"); return; }
    setStatus("Saved ✓", "ok");
    await refreshFromServer();
  }catch{ setStatus("Network error.", "err"); }
});

// Filtering logic
function applyFilters(){
  const q = $("search").value.trim().toLowerCase();
  const fs = $("filterSize").value;
  const fk = $("filterSkill").value;

  const filtered = ALL_DOGS.filter(d=>{
    const hay = `${d.name||""} ${d.notes||""}`.toLowerCase();
    const matchQ = q ? hay.includes(q) : true;
    const matchS = fs ? (d.size === fs) : true;
    const matchK = fk ? (d.walkingSkills === fk) : true;
    return matchQ && matchS && matchK;
  });
  renderList(filtered);
}
$("search").addEventListener("input", applyFilters);
$("filterSize").addEventListener("change", applyFilters);
$("filterSkill").addEventListener("change", applyFilters);
$("clearFilters").addEventListener("click", ()=>{
  $("search").value = ""; $("filterSize").value = ""; $("filterSkill").value = "";
  applyFilters();
});

// Render list
function renderList(dogs){
  if(!dogs.length){ listEl.innerHTML = `<div class="empty">No results.</div>`; return; }
  listEl.innerHTML = dogs.map(d => `
    <div class="item" data-name="${encodeURIComponent(d.name)}" title="Click to load">
      <div class="thumb">${ d.photoUrl ? `<img src="${d.photoUrl}" alt="">` : "" }</div>
      <div class="meta">
        <b>${d.name || "(unnamed)"}</b>
        <small>
          ${d.walkingSkills || "—"} • ${d.size || "?"}${d.weight ? ` • ${d.weight} lb` : ""}
          ${d.lastWalked ? ` • walked ${new Date(d.lastWalked).toLocaleString()}` : ""}
        </small>
      </div>
    </div>
  `).join("");
  listEl.querySelectorAll(".item").forEach(el=>{
    el.addEventListener("click", async ()=>{
      const name = decodeURIComponent(el.getAttribute("data-name"));
      await loadOne(name);
      window.scrollTo({top:0, behavior:"smooth"});
    });
  });
}

// Load all
async function refreshFromServer(){
  try{
    const res = await fetch("/.netlify/functions/dog-get");
    if(!res.ok) throw new Error("fail");
    const data = await res.json();
    ALL_DOGS = data.dogs || [];
    applyFilters();
  }catch{
    listEl.innerHTML = `<div class="empty">Couldn’t load list.</div>`;
  }
}
$("refreshBtn").addEventListener("click", refreshFromServer);

// Load one into form
async function loadOne(name){
  try{
    setStatus(`Loading ${name}…`);
    const res = await fetch(`/.netlify/functions/dog-get?dog=${encodeURIComponent(name)}`);
    if(!res.ok) throw new Error();
    const data = await res.json();
    const d = data.dog;
    if(!d){ setStatus("Not found.", "err"); return; }

    $("name").value = d.name || "";
    $("photoUrl").value = d.photoUrl || "";
    $("size").value = d.size || "";
    $("weight").value = d.weight || "";
    $("notes").value = d.notes || "";

    if(d.walkingSkills){
      const r = document.querySelector(`input[name="walkingSkills"][value="${d.walkingSkills}"]`);
      if(r) r.checked = true; else (document.querySelector('input[name="walkingSkills"][value="Needs training"]')||{}).checked = true;
    }


    $("photoUrl").dispatchEvent(new Event("input"));
    $("lastWalked").value = (d.lastWalked && d.lastWalked.length>=16) ? d.lastWalked.replace('Z','') : "";
    setStatus(`Loaded ${d.name}.`, "ok");
  }catch{ setStatus("Couldn’t load dog.", "err"); }
}

// init
refreshFromServer();
</script>
</body>
</html>
